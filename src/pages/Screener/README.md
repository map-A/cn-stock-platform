# è‚¡ç¥¨ç­›é€‰å™¨ (Stock Screener)

ä¸“ä¸šçš„è‚¡ç¥¨ç­›é€‰å·¥å…·ï¼Œæä¾›å¼ºå¤§çš„ç­›é€‰åŠŸèƒ½å’Œè‰¯å¥½çš„ç”¨æˆ·ä½“éªŒã€‚

## ğŸ“ æ–‡ä»¶ç»“æ„

```
src/pages/Screener/
â”œâ”€â”€ index.tsx                           # ä¸»é¡µé¢å…¥å£
â”œâ”€â”€ index.less                          # ä¸»é¡µé¢æ ·å¼
â”œâ”€â”€ README.md                           # æœ¬æ–‡æ¡£
â”‚
â”œâ”€â”€ types/                              # TypeScript ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ index.ts                        # æ‰€æœ‰ç±»å‹æ¥å£
â”‚
â”œâ”€â”€ constants/                          # å¸¸é‡é…ç½®
â”‚   â”œâ”€â”€ filterOptions.ts                # ç­›é€‰é€‰é¡¹ï¼ˆå¸‚åœºã€è¿ç®—ç¬¦ç­‰ï¼‰
â”‚   â”œâ”€â”€ indicators.ts                   # æŠ€æœ¯/è´¢åŠ¡æŒ‡æ ‡é…ç½®
â”‚   â””â”€â”€ presets.ts                      # é¢„è®¾ç­›é€‰å™¨é…ç½®
â”‚
â”œâ”€â”€ hooks/                              # è‡ªå®šä¹‰ Hooks
â”‚   â”œâ”€â”€ useScreener.ts                  # ç­›é€‰é€»è¾‘ï¼ˆAPIè°ƒç”¨ã€åˆ†é¡µï¼‰
â”‚   â”œâ”€â”€ useFilters.ts                   # ç­›é€‰æ¡ä»¶çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ useCharts.ts                    # å›¾è¡¨æ•°æ®å¤„ç†
â”‚   â””â”€â”€ useExpression.ts                # è¡¨è¾¾å¼è§£æ
â”‚
â””â”€â”€ components/                         # React ç»„ä»¶
    â”œâ”€â”€ FilterPanel/                    # å·¦ä¾§ç­›é€‰é¢æ¿
    â”‚   â”œâ”€â”€ index.tsx                   # ä¸»å®¹å™¨ï¼ˆCollapseå¸ƒå±€ï¼‰
    â”‚   â”œâ”€â”€ index.less                  # æ ·å¼
    â”‚   â”œâ”€â”€ BasicFilters.tsx            # åŸºæœ¬è¿‡æ»¤ï¼ˆå¸‚åœºã€è¡Œä¸šã€å¸‚å€¼ç­‰ï¼‰
    â”‚   â”œâ”€â”€ TechnicalFilters.tsx        # æŠ€æœ¯æŒ‡æ ‡ï¼ˆMAã€RSIã€MACDç­‰ï¼‰
    â”‚   â”œâ”€â”€ FundamentalFilters.tsx      # è´¢åŠ¡æŒ‡æ ‡ï¼ˆROEã€PEã€PBç­‰ï¼‰
    â”‚   â””â”€â”€ CustomRules.tsx             # è‡ªå®šä¹‰è§„åˆ™ç¼–è¾‘å™¨
    â”‚
    â””â”€â”€ ResultPanel/                    # å³ä¾§ç»“æœé¢æ¿
        â”œâ”€â”€ index.tsx                   # ä¸»å®¹å™¨
        â”œâ”€â”€ index.less                  # æ ·å¼
        â”œâ”€â”€ Toolbar.tsx                 # å·¥å…·æ ï¼ˆå¯¼å‡ºã€ä¿å­˜ç­‰ï¼‰
        â”œâ”€â”€ ResultTable.tsx             # ç»“æœè¡¨æ ¼
        â””â”€â”€ StockDetailDrawer.tsx       # è‚¡ç¥¨è¯¦æƒ…æŠ½å±‰
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ä½¿ç”¨ç¤ºä¾‹

```tsx
import Screener from '@/pages/Screener';

// åœ¨è·¯ç”±ä¸­ä½¿ç”¨
<Route path="/screener" component={Screener} />
```

### æ•°æ®æµ

```
ç”¨æˆ·è®¾ç½®ç­›é€‰æ¡ä»¶ (FilterPanel)
        â†“
useFilters Hook ç®¡ç†çŠ¶æ€
        â†“
ç‚¹å‡»"åº”ç”¨ç­›é€‰"æŒ‰é’®
        â†“
useScreener Hook è°ƒç”¨ API
        â†“
æ˜¾ç¤ºç­›é€‰ç»“æœ (ResultPanel)
        â†“
ç‚¹å‡»è¡ŒæŸ¥çœ‹è¯¦æƒ… (StockDetailDrawer)
```

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½

### 1. åŸºæœ¬ç­›é€‰ (BasicFilters)

- âœ… å¸‚åœºé€‰æ‹©ï¼šæ²ªå¸‚ã€æ·±å¸‚ã€åˆ›ä¸šæ¿ã€ç§‘åˆ›æ¿ã€åŒ—äº¤æ‰€
- âœ… è¡Œä¸š/æ¿å—å¤šé€‰ï¼ˆæ”¯æŒæœç´¢ï¼‰
- âœ… å¸‚å€¼èŒƒå›´ï¼ˆé¢„è®¾ + è‡ªå®šä¹‰ï¼‰
- âœ… ä»·æ ¼åŒºé—´
- âœ… äº¤æ˜“é‡åŒºé—´

### 2. æŠ€æœ¯æŒ‡æ ‡ç­›é€‰ (TechnicalFilters)

- âœ… MA å‡çº¿äº¤å‰ï¼ˆå¯é…ç½®å‘¨æœŸå’Œæ¡ä»¶ï¼‰
- âœ… RSI æŒ‡æ ‡ï¼ˆè¶…å–/è¶…ä¹°/è‡ªå®šä¹‰é˜ˆå€¼ï¼‰
- âœ… MACDï¼ˆé‡‘å‰/æ­»å‰/æŸ±çŠ¶å›¾ï¼‰
- âœ… æ³¢åŠ¨ç‡ï¼ˆé«˜/ä¸­/ä½ï¼‰

### 3. è´¢åŠ¡æŒ‡æ ‡ç­›é€‰ (FundamentalFilters)

- âœ… ROEï¼ˆå‡€èµ„äº§æ”¶ç›Šç‡ï¼‰
- âœ… PEï¼ˆå¸‚ç›ˆç‡ï¼Œæ”¯æŒ TTM/é™æ€ï¼‰
- âœ… PBï¼ˆå¸‚å‡€ç‡ï¼‰
- âœ… æ¯›åˆ©ç‡ã€å‡€åˆ©ç‡
- âœ… EPSå¢é•¿ç‡ã€è¥æ”¶å¢é•¿ç‡
- âœ… èµ„äº§è´Ÿå€ºç‡

### 4. è‡ªå®šä¹‰è§„åˆ™ (CustomRules)

- âœ… åŠ¨æ€æ·»åŠ /åˆ é™¤è§„åˆ™
- âœ… å­—æ®µé€‰æ‹©ï¼ˆ20+ ä¸ªæŒ‡æ ‡ï¼‰
- âœ… è¿ç®—ç¬¦é€‰æ‹©ï¼ˆ>ã€<ã€=ã€betweenã€inï¼‰
- âœ… é€»è¾‘å…³ç³»ï¼ˆAND/ORï¼‰

### 5. ç»“æœå±•ç¤º (ResultPanel)

- âœ… é«˜æ€§èƒ½è¡¨æ ¼ï¼ˆæ”¯æŒæ’åºã€åˆ†é¡µï¼‰
- âœ… å®æ—¶ç»Ÿè®¡ï¼ˆå½“å‰/æ€»æ•°ï¼‰
- âœ… å¯¼å‡º CSVï¼ˆå½“å‰é¡µ/å…¨éƒ¨ï¼‰
- âœ… ä¿å­˜ç­›é€‰å™¨
- âœ… ä¿å­˜ä¸ºç­–ç•¥

### 6. è‚¡ç¥¨è¯¦æƒ… (StockDetailDrawer)

- âœ… åŸºæœ¬ä¿¡æ¯ï¼ˆä»£ç ã€åç§°ã€å¸‚åœºã€è¡Œä¸šï¼‰
- âœ… ä»·æ ¼ä¿¡æ¯ï¼ˆå½“å‰ä»·ã€æ¶¨è·Œå¹…ã€æˆäº¤é‡ï¼‰
- âœ… è´¢åŠ¡æŒ‡æ ‡ï¼ˆPEã€PBã€ROEç­‰ï¼‰
- âœ… å¿«é€Ÿæ“ä½œï¼ˆåŠ è‡ªé€‰ã€è®¾æé†’ã€æŸ¥çœ‹è¯¦æƒ…ï¼‰

## ğŸ“¦ ä¾èµ–

### å·²æœ‰ä¾èµ–
- `antd` - UI ç»„ä»¶åº“
- `@ant-design/pro-components` - ProComponents
- `@ant-design/icons` - å›¾æ ‡
- `react` - æ ¸å¿ƒæ¡†æ¶
- `@umijs/max` - Umi æ¡†æ¶

### æ¨èæ–°å¢ï¼ˆå¯é€‰ï¼‰
- `@dnd-kit/core` - æ‹–æ‹½æ’åºï¼ˆç”¨äºè§„åˆ™æ’åºï¼‰
- `@monaco-editor/react` - ä»£ç ç¼–è¾‘å™¨ï¼ˆé«˜çº§è¡¨è¾¾å¼ï¼‰
- `echarts-for-react` - å›¾è¡¨åº“ï¼ˆå·²æœ‰ï¼‰

## ğŸ¯ API æ¥å£

ç­›é€‰å™¨ä¾èµ–ä»¥ä¸‹ API æ¥å£ï¼ˆåœ¨ `src/services/screener.ts` ä¸­å®šä¹‰ï¼‰ï¼š

### å¿…éœ€æ¥å£

1. **screenStocksV2** - æ‰§è¡Œç­›é€‰
   ```ts
   POST /api/screener/v2/stocks
   Body: { filters, page, pageSize, sortBy, sortOrder }
   ```

2. **getIndustries** - è·å–è¡Œä¸šåˆ—è¡¨
   ```ts
   GET /api/screener/industries
   ```

3. **getSectors** - è·å–æ¿å—åˆ—è¡¨
   ```ts
   GET /api/screener/sectors
   ```

4. **saveScreener** - ä¿å­˜ç­›é€‰å™¨
   ```ts
   POST /api/screener/saved
   Body: { name, description, filters }
   ```

### å¯é€‰æ¥å£

5. **getTechnicalIndicators** - è·å–æŠ€æœ¯æŒ‡æ ‡æ•°æ®
6. **getFundamentalIndicators** - è·å–è´¢åŠ¡æŒ‡æ ‡æ•°æ®
7. **validateExpression** - éªŒè¯è¡¨è¾¾å¼
8. **getBatchMiniCharts** - æ‰¹é‡è·å–è¿·ä½ å›¾
9. **saveAsStrategy** - ä¿å­˜ä¸ºç­–ç•¥
10. **exportResults** - å¯¼å‡ºç»“æœ

## ğŸ”„ çŠ¶æ€ç®¡ç†

### useFilters Hook

ç®¡ç†æ‰€æœ‰ç­›é€‰æ¡ä»¶ï¼š

```ts
const {
  filters,                    // å½“å‰ç­›é€‰æ¡ä»¶
  updateBasicFilters,         // æ›´æ–°åŸºæœ¬ç­›é€‰
  updateTechnicalFilters,     // æ›´æ–°æŠ€æœ¯æŒ‡æ ‡
  updateFundamentalFilters,   // æ›´æ–°è´¢åŠ¡æŒ‡æ ‡
  addCustomRule,              // æ·»åŠ è‡ªå®šä¹‰è§„åˆ™
  updateCustomRule,           // æ›´æ–°è§„åˆ™
  removeCustomRule,           // åˆ é™¤è§„åˆ™
  resetFilters,               // é‡ç½®æ‰€æœ‰æ¡ä»¶
  validateFilters,            // éªŒè¯æ¡ä»¶
  hasAnyFilter,               // æ˜¯å¦æœ‰ä»»ä½•æ¡ä»¶
} = useFilters();
```

### useScreener Hook

ç®¡ç†ç­›é€‰æ‰§è¡Œå’Œç»“æœï¼š

```ts
const {
  loading,                    // åŠ è½½çŠ¶æ€
  results,                    // ç­›é€‰ç»“æœ
  total,                      // æ€»æ•°
  currentPage,                // å½“å‰é¡µ
  pageSize,                   // æ¯é¡µæ•°é‡
  executeScreen,              // æ‰§è¡Œç­›é€‰
  changePage,                 // åˆ‡æ¢é¡µç 
  resetResults,               // é‡ç½®ç»“æœ
  exportResults,              // å¯¼å‡ºç»“æœ
} = useScreener();
```

## ğŸ¨ æ ·å¼è‡ªå®šä¹‰

ä¸»è¦æ ·å¼æ–‡ä»¶ï¼š
- `index.less` - ä¸»é¡µé¢å¸ƒå±€
- `components/FilterPanel/index.less` - ç­›é€‰é¢æ¿
- `components/ResultPanel/index.less` - ç»“æœé¢æ¿

å¯è‡ªå®šä¹‰ï¼š
- é¢æ¿å®½åº¦æ¯”ä¾‹ï¼ˆé»˜è®¤ 6:18ï¼‰
- é¢œè‰²ä¸»é¢˜
- ç»„ä»¶é—´è·
- åŠ¨ç”»æ•ˆæœ

## ğŸ› å·²çŸ¥é—®é¢˜

1. **åˆ—å®½æ‹–æ‹½** - å¾…å®ç°
2. **è™šæ‹Ÿæ»šåŠ¨** - å¤§æ•°æ®é‡æ—¶éœ€è¦ä¼˜åŒ–
3. **å›¾è¡¨åŒºåŸŸ** - å¾…å®ç°ï¼ˆPhase 7ï¼‰
4. **é«˜çº§è¡¨è¾¾å¼** - å¾…å®ç°ï¼ˆPhase 6ï¼‰
5. **é¢„è®¾ç­›é€‰å™¨å¡ç‰‡** - å¾…å®ç°ï¼ˆPhase 4ï¼‰

## ğŸ“ å¼€å‘è®¡åˆ’

è¯¦è§ `/SCREENER_TODO.md` æ–‡æ¡£ã€‚

å½“å‰è¿›åº¦ï¼š**Phase 1-3 å·²å®Œæˆï¼ŒPhase 4-10 å¾…å¼€å‘**

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. éµå¾ªé¡¹ç›®çš„ä»£ç è§„èŒƒ
2. ç»„ä»¶æ‹†åˆ†æ¸…æ™°ï¼Œå•ä¸€èŒè´£
3. ä½¿ç”¨ TypeScript ä¸¥æ ¼ç±»å‹
4. æ·»åŠ å¿…è¦çš„æ³¨é‡Š
5. æ›´æ–°ç›¸å…³æ–‡æ¡£

## ğŸ“„ è®¸å¯

ä¸ä¸»é¡¹ç›®ä¿æŒä¸€è‡´

---

**åˆ›å»ºæ—¶é—´**: 2025-11-17  
**æœ€åæ›´æ–°**: 2025-11-17  
**ç»´æŠ¤è€…**: AI Assistant
